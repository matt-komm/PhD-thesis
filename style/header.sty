%% Xheader by mKomm
%% Use with book (standard) document class not KOMA!

\usepackage[a4paper,total={12cm,20cm},headsep=12pt,headheight=12pt,footskip=8pt,centering,includehead]{geometry}
%\usepackage[nouppercase,headsepline]{scrpage2}
\usepackage[nouppercase]{scrpage2}
\usepackage{ifthen}
\usepackage{amsmath}


%%FONTS


%special
\usepackage{calligra}
\usepackage{miama} %activate with \fmmfamily
\usepackage{humanist} %activate with \hminfamily
\usepackage{auncial} %activate with \aunclfamily
\usepackage{pbsi}
\usepackage{aurical}
\usepackage{carolmin} %activate with \cminfamily
\usepackage{sqrcaps}
\usepackage{inslrmaj}
\usepackage{trajan} %activate with \trjnfamily



%\usepackage{euler}

%serif

%\usepackage{mathpple}
%\usepackage{newtxtext,newtxmath}
%\usepackage{newpxtext,eulerpx}
%\usepackage{mbtimes}

%\usepackage{kpfonts}

\usepackage[sc]{mathpazo}

%\usepackage{times}

%\usepackage[bitstream-charter]{mathdesign}


%\usepackage{mathpazo}
%\usepackage{newtxmath}
%\usepackage[utopia]{mathdesign}
%\usepackage{fourier}
%\usepackage[charter]{mathdesign}
%\usepackage{mathptmx}

%sans serif
%\usepackage{comfortaa}
%\usepackage{tgheros}
%\usepackage[default]{gfsneohellenic}
\usepackage[scale=1.11]{biolinum}
%\usepackage{cabin}
%\usepackage{carlito}
%\usepackage[sf]{quattrocento}


%\usepackage{libertinust1math}

%typewriter
%\usepackage{courier}
\usepackage[scaled=1.05]{inconsolata}



\usepackage[B1,OT1,T1]{fontenc}
\usepackage[latin9]{inputenc}

\pagestyle{scrheadings}
\usepackage{scrextend}
\usepackage{lipsum}
\usepackage{enumitem}
\usepackage{color}
\usepackage{xcolor} %more advance color usage
\definecolor{ucl}{rgb}{0.05,0.15,0.45}
\definecolor{gray}{rgb}{0.65,0.65,0.65}

\usepackage{array}%tabellanartige Strukturen z.B. fuer Formeln Spalten im mathematischen Modus
\usepackage{calc}%erweitert setlength etc. damit auch arithmetische Funktionen benutzt werden koennen
\usepackage[hyphens]{url}
\Urlmuskip=0mu plus 1mu\relax
\usepackage{chngcntr} %fuer nummerierung der figures, tables, footnotes
\usepackage[activate={true,nocompatibility},final,tracking=true,kerning=true,spacing=nonfrench,factor=1100,stretch=15,shrink=15]{microtype}
\SetTracking{encoding={*}, shape=sc}{0}
\usepackage{slashed}
\usepackage{bm} % bold math symbols
\usepackage{afterpage}
\usepackage{graphicx,graphics}
\usepackage{tocloft}
\usepackage{etoolbox}
\usepackage{mdframed}
\usepackage{multirow}
\usepackage{setspace}
\usepackage[Symbolsmallscale]{upgreek} % for upright greek symbols
\usepackage{xr} %ref over documents
\usepackage{axodraw4j}
\usepackage[hyperfootnotes=false,colorlinks=false,hidelinks=true,breaklinks=true]{hyperref}
\usepackage[color=white,linecolor=red,bordercolor=red,textsize
=small]{todonotes}
\setlength{\marginparwidth}{3cm}
\usepackage[perpage]{footmisc}
\usepackage{xspace} %intelligent spacing e.g. after inline equations
\usepackage[nottoc]{tocbibind} %puts references into toc
%\usepackage[nopostdot,toc,acronym,style=super]{glossaries} %list of abbreviations
\usepackage[nopostdot,toc,acronym,style=super]{glossaries-extra}
\usepackage{glossary-mcols}
\usepackage{stringstrings} %substrings
\usepackage{anyfontsize}

%global styles
%\newcommand*{\numberfont}{\fontfamily{pplj}\selectfont}
%\newcommand*{\numberfont}{\fontfamily{qcs}\selectfont}
%\newcommand*{\numberfont}{\fontfamily{qhv}\selectfont}
%\newcommand*{\numberfont}{\fontfamily{pbk}\selectfont}

\newcommand*{\numberfont}{\sffamily\selectfont}

\newlength{\myrulewidth}
\setlength{\myrulewidth}{0.7pt}

\def\hrulefill{\leavevmode\leaders\hrule height \myrulewidth\hfill\kern\z@}


%line numbers
\usepackage{lineno} 
\renewcommand\linenumberfont{\color{gray}\normalfont\small\ttfamily}
%\linenumbers

%abbreviations
\makeglossaries

\renewcommand{\glstextformat}[1]{#1}
%\renewcommand*{\glstextformat}[1]{\textsf{\textsc{#1}}}
\renewcommand{\glsnamefont}[1]{\boldmath{\textbf{ #1}}}

\let\glsold\gls
\let\glsplold\glspl
\let\Glsold\Gls
\let\Glsplold\Glspl
\renewcommand{\gls}[1]{\glsold[noindex]{#1}}
\renewcommand{\glspl}[1]{\glsplold[noindex]{#1}}
\renewcommand{\Gls}[1]{\Glsold[noindex]{#1}}
\renewcommand{\Glspl}[1]{\Glsplold[noindex]{#1}}

\setlength{\glspagelistwidth}{\textwidth}
\setlength{\tabcolsep}{1ex}
\setlength{\extrarowheight}{0.0cm}
\setlength{\glsdescwidth}{0.8\textwidth}
\renewcommand*{\glsgroupskip}{}

\newcommand{\glshere}[1]{\glsreset{#1}\acrfull{#1}}
\newcommand{\glsplhere}[1]{\glsreset{#1}\acrfullpl{#1}}
\newcommand{\Glshere}[1]{\glsreset{#1}\Acrfull{#1}}
\newcommand{\Glsplhere}[1]{\glsreset{#1}\Acrfullpl{#1}}


\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}

\newglossarystyle{tabx3col}{%
 % put the glossary in a longtable environment:
 \renewenvironment{theglossary}%
  {\begin{longtable}{L{0.13\textwidth}L{0.77\textwidth}R{0.1\textwidth}}}%
  {\end{longtable}}%
 % Set the table's header:
 \renewcommand*{\glossaryheader}{}%
 % No heading between groups:
  \renewcommand*{\glsgroupheading}[1]{\\[0.3\parskip]}%
 % Main (level 0) entries displayed in a row:
  \renewcommand*{\glossaryentryfield}[5]{%
    \glstarget{##1}{\textbf{##2}}% Name
    & ##3% Description
    & ##5% Page list
    \\% end of row
  }%
}

\newglossarystyle{myglstyle}{%
 % put the glossary in a longtable environment:
 \renewenvironment{theglossary}%
  {\setlength{\columnsep}{0.05\textwidth}\begin{multicols}{2}\begin{description}}%begin
  {\end{description}\end{multicols}}%end
 % Set the table's header:
 \renewcommand*{\glossaryheader}{}%
 % No heading between groups:
  \renewcommand*{\glsgroupheading}[1]{\item[]}%
 % Main (level 0) entries displayed in a row:
  \renewcommand*{\glossaryentryfield}[5]{%
    \item[\glstarget{##1}{\textbf{##2}}] ##3 \hspace{0.5em} ##5
}
}




%% Setup TOC
\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{3}
\renewcommand{\cfttoctitlefont}{\Huge\numberfont}
\renewcommand{\cftchapfont}{\rm\bf}
\renewcommand{\cftsecfont}{}
\newcommand{\nocontentsline}[3]{}
\newcommand{\tocless}[2]{\bgroup\let\addcontentsline=\nocontentsline#1{#2}\egroup}

\newcommand{\appendixchapter}[1]{\tocless\chapter{#1}\addcontentsline{toc}{chapter}{\textbf{\chaptername~\thechapter\quad#1}}}
%\newcommand{\appendixchapter}[1]{\chapter{#1}}

%% Setup HEADER/FOOTER
\clearscrheadfoot
\ihead{\headmark}
\ohead[\pagemark]{\pagemark}
\renewcommand{\chaptermark}[1]{\markboth{{\numberfont\color{gray}\chaptername\,\thechapter}\enspace #1}{}}
\renewcommand{\sectionmark}[1]{\markright{{\numberfont\color{gray}\thesection}\enspace #1}}
\renewcommand{\subsectionmark}[1]{\markright{{\numberfont\color{gray}\thesubsection}\enspace #1}}
\fboxrule=\myrulewidth
%\ohead[\vspace{-0.6pt}\fcolorbox{gray}{gray!30}{\parbox[c][][c]{0.6cm}{\pagemark}}]{\vspace{-0.6pt}\fcolorbox{gray}{gray!30}{\parbox[c][][c]{0.6cm}{\pagemark}}}

%\renewcommand{\pagemark}{\markboth{\bf\color{gray}\thepage}{\bf\color{gray}\thepage}}

\setheadsepline{\myrulewidth}[\color{gray}]
%Vergroessere head&foot Breite
%\setheadwidth[0.5cm]{text}
%\setfootwidth[0.5cm]{text}
%Headschrift
\renewcommand*{\headfont}{\numberfont\small\slshape}
%\renewcommand*{\headfont}{\numberfont\small}
%\renewcommand{\headrulewidth}{0.5pt}
%alternativ: \renewcommand*{\headfont}{\normalfont\sffamily\scshape\large}
%Footschrift
%\renewcommand*{\footfont}{\numberfont}
%Seitenzahlschrift
\renewcommand*{\pnumfont}{\numberfont\small\upshape}


\renewcommand*\chapterpagestyle{empty} %removes header from all chapter pages
\addtocontents{toc}{\protect\thispagestyle{empty}} %hack to remove also header from 1st TOC page

\KOMAoptions{cleardoublepage=scrheadings} %adds header to cleared double pages


%% make env for pagestyle
\newenvironment{clearedpagestyle}{\clearpage\pagestyle{empty}\KOMAoptions{cleardoublepage=empty}}{\clearpage\pagestyle{scrheadings}\KOMAoptions{cleardoublepage=scrheadings}}



\mdfdefinestyle{chstyle}{%
    linewidth=0\myrulewidth,
    leftmargin=0pt,
    innerleftmargin=0.03\textwidth,
    rightmargin=0pt,
    innerrightmargin=0pt,
    innertopmargin=0pt,
    innerbottommargin=0pt,
    linecolor=gray,
    topline=false,
    rightline=false,
    bottomline=false,
    leftline=true
}

\def\headline#1{ {\color{gray}\hbox to \hsize{\lower.3em\hbox{#1}\hspace{2.5ex}\hrulefill}}}

\def\@makechapterhead#1{
     \parbox{\textwidth}{
        \chapterheadstartvskip
        %\parbox{\textwidth}{\headline{\textls*[180]{\Large\textsf{\chaptername}}\quad\LARGE\numberfont{\thechapter}}}\\[0.55cm]
        {\color{gray}\Large\textsf{\chaptername}\quad\fontsize{30}{30}\numberfont{\raisebox{-0.13em}{\thechapter}}}\\[0.55cm]
        %\vspace{0.55cm}
        \parbox{\textwidth}{\usekomafont{chapter} #1}\\[0.45cm]
        %\vspace{0.45cm}
        %\parbox{\textwidth}{\color{gray}\rule{\textwidth}{\myrulewidth}}\\[0.0cm]
    }
}

\setkomafont{chapter}{\normalfont\Huge\selectfont\numberfont}
\renewcommand*{\chapterheadstartvskip}{\vspace{0.5cm}}
\renewcommand*{\chapterheadendvskip}{\vspace{0.8cm}}

\setkomafont{section}{\normalfont\LARGE\numberfont}
\setkomafont{subsection}{\normalfont\LARGE\numberfont}
\setkomafont{subsubsection}{\normalfont\LARGE\numberfont}

\RedeclareSectionCommands[
  beforeskip=0.9\baselineskip,
  afterskip=0.01\baselineskip
]{section,subsection,subsubsection}


\renewcommand{\@seccntformat}[1]{\csname the#1\endcsname.\hspace{1ex}} %dot after the(sub)section

%strecke zeilenabstände im table
\newcommand{\mytablestrech}{1.4}
\renewcommand{\arraystretch}{\mytablestrech}

%Schicke Bild- und Tabellenbeschreibungen

\usepackage[format=plain,indention=0.0cm]{caption} %use same as for parindent
\newlength{\letterheight}
\settoheight{\letterheight}{T}
\DeclareCaptionLabelSeparator{vline}{.\hspace{1.ex}{\color{gray}\rule{2\myrulewidth}{\letterheight}}\hspace{1.6ex}}
%\usepackage{subcaption}
\usepackage{subfig}
%\captionsetup{width=0.93\textwidth}

\setkomafont{captionlabel}{\bfseries\numberfont\small}
\renewcommand{\thefigure}{\arabic{chapter}.\arabic{figure}}
\renewcommand{\thesubfigure}{\alph{subfigure}}
\renewcommand{\thetable}{\arabic{chapter}.\arabic{table}}
%abstand zwischen caption und figure,table
\captionsetup[figure]{labelsep=vline,font={small,stretch=1.12},aboveskip=0.8\baselineskip,belowskip=0\baselineskip}
\captionsetup[table]{labelsep=vline,font={small,stretch=1.12},aboveskip=0\baselineskip,belowskip=0.8\baselineskip}
\captionsetup[subfloat]{labelsep=space,font={small,stretch=1.12},captionskip=0.5\baselineskip} %distance between fig & subcaption

\setlength\floatsep{1.\baselineskip plus 3pt minus 2pt}
\setlength\textfloatsep{1.\baselineskip plus 3pt minus 2pt}
\setlength\intextsep{1.\baselineskip plus 3pt minus 2pt}

%placements
\newcommand{\mytable}[3][htb]{
    \begin{table}[#1]
    \centering
    \begin{minipage}[c]{0.93\textwidth}
    \caption{#2}
    \centering
    \small #3
    \end{minipage}
    \end{table}
}

\newcommand{\myfigure}[3][htb]{
    \begin{figure}[#1]
    \centering
    \begin{minipage}[c]{0.93\textwidth}
    \centering
    #3
    \caption{#2}
    \end{minipage}
    \end{figure}
}

%references font
%\renewcommand\theremark{{\itshape\thesection\arabic{remark}}\reset@font}

% New definition of square root:
% it renames \sqrt as \oldsqrt
\let\oldsqrt\sqrt
% it defines the new \sqrt in terms of the old one
\def\sqrt{\mathpalette\DHLhksqrt}
\def\DHLhksqrt#1#2{%
\setbox0=\hbox{$#1\oldsqrt{#2\,}$}\dimen0=\ht0
\advance\dimen0-0.2\ht0
\setbox2=\hbox{\vrule height\ht0 depth -\dimen0}%
{\box0\lower0.38pt\box2}}

% define prime with better vertical alignment and no vertical space to fix line spreading
\let\oldprime\prime
\def\prime{\mathalpha{\raisebox{-0.5pt}[0pt][0pt]{$\scriptstyle\oldprime$}}}


%no linebreaks for inline equations
\binoppenalty=\maxdimen
\relpenalty=\maxdimen


%\def\prime{\mathpalette\myprime} 
%\def\myprime{\setbox0=-} %\raisebox{4.5pt}{$\scriptstyle\oldprime$}}

%% change equation numbering style
\def\tagform@#1{\maketag@@@{\ignorespaces{\small\numberfont(#1.)\enspace}\unskip\@@italiccorr}} %kill parenthesis
\renewcommand{\theequation}{\thechapter.\arabic{equation}}

%% paragraphs
\renewcommand\paragraph{\@startsection{paragraph}{4}{\z@}%
    {-0.1\parskip}%
    {-1em}%
    {\normalfont\normalsize\bfseries}
}

%%chapter intro
\newcommand{\intro}[1]{\parbox{\textwidth}{\textsl{#1}}\\[4\parskip]}


%% footnote
%\def\@fnsymbol#1{\ifcase#1\or $\bullet$\or $\bullet\bullet$\or $\bullet\bullet\bullet$\or$\bullet\bullet\bullet\bullet$\or $\bullet\bullet\bullet\bullet\bullet$\or \else\@ctrerr\fi} %define alternative numbering using *, **, ***, ...
\def\@fnsymbol#1{{\tiny(}\ifcase#1\or $\boldsymbol{\star}$\or $\boldsymbol{\star}\boldsymbol{\star}$\or $\boldsymbol{\star}\boldsymbol{\star}\boldsymbol{\star}$\or $\boldsymbol{\star}\boldsymbol{\star}\boldsymbol{\star}\boldsymbol{\star}$\or \else\@ctrerr\fi{\tiny)}}
%\renewcommand{\thefootnote}{\numberfont\arabic{footnote}} %style
\renewcommand{\thefootnote}{\numberfont\fnsymbol{footnote}} %style
%\counterwithin*{footnote}{page} %reset counter per new page
\setlength{\footnotesep}{\parskip}
\addtokomafont{footnote}{\small\setstretch{1.12}}
\renewcommand{\footnoterule}{%
  \vspace{-0.5\parskip}
  \vspace{\footskip}
  {\color{gray}\hrule width 0.35\textwidth height \myrulewidth}
  \kern 2pt
  
  %\vspace{-0.5\footnotesep}
}
%\renewcommand{\footnotelayout}{}

\deffootnote[2em] %mark width - allows 4 **** to be placed
      {2em} %indent of text
      {1em} %indent of paragraph
      {\textsuperscript{\thefootnotemark}\hspace{0.3em}} %def mark
      
%% Lists
\setlist[itemize,enumerate]{leftmargin=0.05\textwidth,itemsep=0.5\parskip,parsep=0pt,partopsep=0pt, topsep=0.0\parskip}
\setlist[description]{leftmargin=0.05\textwidth,font=\normalfont\rmfamily\bfseries,itemsep=0.5\parskip,parsep=0pt,partopsep=0pt, topsep=0.0\parskip}
\renewcommand*{\descriptionlabel}[1]{\hspace{\labelsep}\descfont #1\hspace{0.3em}}

%Sonst================================================
\setlength{\jot}{2.0ex plus 0.5ex minus 0.2ex} %Vergroessert Zeilenabstand in align-Umgebung


%% Bib
%\renewcommand\@biblabel[1]{ [{\small\numberfont#1}]}
\setlength{\labelsep}{1.25ex}


\newcommand{\setupTextStyle}{
    \setlength{\parindent}{0.cm} %Absatzeinzug
    \setlength{\parskip}{0.4\baselineskip plus 0.15\baselineskip minus 0.02\baselineskip}
    %\setlength{\parsep}{0cm}
    \renewcommand{\baselinestretch}{1.10}\normalsize


    %formel abstände 
    \setlength{\abovedisplayskip}{-1.\parskip plus 0.2\parskip minus 0.2\parskip}
    \setlength{\abovedisplayshortskip}{-1.\parskip plus 0.2\parskip minus 0.2\parskip}
    \setlength{\belowdisplayskip}{0.5\parskip plus 0.2\parskip minus 0.2\parskip}
    \setlength{\belowdisplayshortskip}{0.5\parskip plus 0.2\parskip minus 0.2\parskip}
}

