%% Xheader by mKomm
%% Use with book (standard) document class not KOMA!

\usepackage[a4paper,total={12cm,20cm},headsep=10pt,headheight=12pt,footskip=0pt,centering,includehead]{geometry}
%\usepackage[nouppercase,headsepline]{scrpage2}
\usepackage[nouppercase]{scrpage2}
\usepackage{ifthen}
\usepackage{amsmath}
\allowdisplaybreaks[1] %allows breaks but avoids them as much as possible

%%FONTS


%special
%\usepackage{calligra}
%\usepackage{miama} %activate with \fmmfamily
%\usepackage{humanist} %activate with \hminfamily
%\usepackage{auncial} %activate with \aunclfamily
%\usepackage{pbsi}
%\usepackage{aurical}
%\usepackage{carolmin} %activate with \cminfamily
%\usepackage{sqrcaps}
%\usepackage{inslrmaj}
%\usepackage{trajan} %activate with \trjnfamily



%\usepackage{euler}

%serif

%\usepackage{mathpple}
%\usepackage{newtxtext,newtxmath}
%\usepackage{newpxtext,eulerpx}
%\usepackage{mbtimes}

%\usepackage{kpfonts}

\usepackage[sc]{mathpazo}
%\usepackage{times}

%\usepackage[bitstream-charter]{mathdesign}


%\usepackage{palatino} %cms
%\usepackage{mathpazo} %cms

%\usepackage{mathpazo}
%\usepackage{newtxmath}
%\usepackage[utopia]{mathdesign}
%\usepackage{fourier}
%\usepackage[charter]{mathdesign}
%\usepackage{mathptmx}

%sans serif
\usepackage{comfortaa}
%\usepackage{tgheros}
%\usepackage[default]{gfsneohellenic}
%\usepackage[scale=1.11]{biolinum}
%\usepackage{cabin}
%\usepackage{carlito}
%\usepackage[sf]{quattrocento}


%\usepackage{libertinust1math}

%typewriter
%\usepackage{courier}
\usepackage[scaled=1.05]{inconsolata}



\usepackage[OT1,T1]{fontenc}
\usepackage[latin9]{inputenc}

\pagestyle{scrheadings}
\usepackage{scrextend}
\usepackage{lipsum}
\usepackage{enumitem}
\usepackage{color}
\usepackage{xcolor} %more advance color usage
\definecolor{ucl}{rgb}{0.05,0.15,0.45}
\definecolor{gray}{rgb}{0.7,0.7,0.7}
\definecolor{textgray}{rgb}{0.65,0.65,0.65}
\definecolor{lightgray}{rgb}{0.85,0.85,0.85}
\definecolor{darkgreen}{rgb}{0.0,0.45,0.}
\definecolor{darkblue}{rgb}{0.0,0.0,0.5}

\usepackage{array}%tabellanartige Strukturen z.B. fuer Formeln Spalten im mathematischen Modus
\usepackage{calc}%erweitert setlength etc. damit auch arithmetische Funktionen benutzt werden koennen
\usepackage[hyphens,obeyspaces]{url}
\Urlmuskip=0mu plus 1mu\relax
\usepackage{chngcntr} %fuer nummerierung der figures, tables, footnotes
\usepackage[activate={true,nocompatibility},final,tracking=true,kerning=true,spacing=nonfrench,factor=1100,stretch=15,shrink=15]{microtype}
\SetTracking{encoding={*}, shape=sc}{0}
\usepackage{slashed}
\usepackage{bm} % bold math symbols
\usepackage{afterpage}
\usepackage{graphicx,graphics}
\usepackage{tocloft}
\usepackage{relsize} %defines mathlarger
\usepackage{xfrac}
\usepackage{supertabular}
\usepackage{booktabs} %toprule stuff
\setlength{\heavyrulewidth}{1pt}
\usepackage{stackengine}
\usepackage{scalerel}
%\usepackage{showframe} % shows page margins
%\renewcommand*\ShowFrameColor{\color{lightgray}}
%\overfullrule=1mm %marks overfull boxes
\usepackage{etoolbox}
\usepackage{flafter} %prevent float to appear to early
\usepackage{hanging}
\usepackage[export]{adjustbox} %clip figures
\usepackage{mdframed}
\usepackage{verse}
\usepackage{rotating}
\usepackage{cite} % turns citations [1,2,3] -> [1-3]
\usepackage{pdflscape}
\usepackage{tikz} %for drawing
\usetikzlibrary{calc,shapes,matrix}
\usepackage{multirow}
\usepackage{setspace}
\usepackage[Symbolsmallscale]{upgreek} % for upright greek symbols
\usepackage{xr} %ref over documents
\usepackage{axodraw4j}
%\usepackage[hyperfootnotes=false,colorlinks=false,hidelinks=false,breaklinks=true,linkcolor=gray]{hyperref}
%\usepackage[hyperfootnotes=false,breaklinks=true,colorlinks=false,pdfborder={20 20 0.5},citebordercolor=green]{hyperref}
%\usepackage[hyperfootnotes=false,colorlinks=true,breaklinks=true,allcolors=darkblue,citecolor=darkgreen]{hyperref}
\usepackage[color=white,linecolor=red,bordercolor=red,textsize
=small]{todonotes}
\setlength{\marginparwidth}{3cm}
\usepackage[perpage]{footmisc}
\usepackage{xspace} %intelligent spacing e.g. after inline equations
\usepackage[nottoc]{tocbibind} %puts references into toc
%\usepackage[nopostdot,toc,acronym,style=super]{glossaries} %list of abbreviations
\usepackage[nopostdot,toc,acronym,style=super]{glossaries-extra}
\usepackage{glossary-mcols}
\usepackage{stringstrings} %substrings
\usepackage{anyfontsize}

%global styles
%\newcommand*{\numberfont}{\fontfamily{pplj}\selectfont}
%\newcommand*{\numberfont}{\fontfamily{qcs}\selectfont}
%\newcommand*{\numberfont}{\fontfamily{qhv}\selectfont}
%\newcommand*{\numberfont}{\fontfamily{pbk}\selectfont}

\newcommand*{\numberfont}{\sffamily\selectfont}

\newlength{\myrulewidth}
\setlength{\myrulewidth}{0.9pt}

\def\hrulefill{\leavevmode\leaders\hrule height \myrulewidth\hfill\kern\z@}


%line numbers
\usepackage{lineno} 
\renewcommand\linenumberfont{\color{gray}\normalfont\small\ttfamily}
%\linenumbers

%abbreviations
\makeglossaries

%\renewcommand{\glstextformat}[1]{#1}
%\renewcommand*{\glstextformat}[1]{\textsf{\textsc{#1}}}
%\renewcommand{\glsnamefont}[1]{\boldmath{\textbf{#1}}}

\let\glsold\gls
\let\glsplold\glspl
\let\Glsold\Gls
\let\Glsplold\Glspl

\renewcommand{\gls}[2][]{\acrshort[#1]{#2}}
\renewcommand{\glspl}[2][]{\acrshortpl[#1]{#2}}
\renewcommand{\Gls}[2][]{\Acrshort[#1]{#2}}
\renewcommand{\Glspl}[2][]{\Acrshortpl[#1]{#2}}

\newcommand{\glshere}[1]{\acrfull[format=hyperbf]{#1}}
\newcommand{\glsplhere}[1]{\acrfullpl[format=hyperbf]{#1}}
\newcommand{\Glshere}[1]{\Acrfull[format=hyperbf]{#1}}
\newcommand{\Glsplhere}[1]{\Acrfullpl[format=hyperbf]{#1}}

\newcommand{\glsmark}[1]{\acrshort[format=hyperbf]{#1}}
\newcommand{\glsplmark}[1]{\acrshortpl[format=hyperbf]{#1}}
\newcommand{\Glsmark}[1]{\Acrshort[format=hyperbf]{#1}}
\newcommand{\Glsplmark}[1]{\Acrshortpl[format=hyperbf]{#1}}

\newcommand{\glsfull}[1]{\acrfull[format=hyperrm]{#1}}
\newcommand{\glsplfull}[1]{\acrfullpl[format=hyperrm]{#1}}
\newcommand{\Glsfull}[1]{\Acrfull[format=hyperrm]{#1}}
\newcommand{\Glsplfull}[1]{\Acrfullpl[format=hyperrm]{#1}}

\setlength{\glspagelistwidth}{\textwidth}
\setlength{\tabcolsep}{1ex}
\setlength{\extrarowheight}{0.0cm}
\setlength{\glsdescwidth}{1.\textwidth}
\setlength{\glstreeindent}{0pt}

\renewcommand*{\glsgroupskip}{}





\setlength{\columnsep}{0.06\textwidth}



\newglossarystyle{myglstyle}{%
 % put the glossary in a longtable environment:
 \renewenvironment{theglossary}%
  %{\begin{multicols}{2}\begin{description}}%begin
  %{\end{description}\end{multicols}}%end
   {\begin{multicols*}{2}}%begin
   {\end{multicols*}}%end
 % Set the table's header:
 \renewcommand*{\glossaryheader}{}%
 % No heading between groups:
  \renewcommand*{\glsgroupheading}[1]{
  %\item\boldmath{\textbf{\glsgetgrouptitle{##1}}}
  }%
 % Main (level 0) entries displayed in a row:
  \renewcommand*{\glossaryentryfield}[5]{%
    \begin{minipage}[t]{\columnwidth}
    %\begin{list}{}{\leftmargin=1em \itemindent=-1em}
    %\item %
    \hangindent=1.5em
    \glstarget{##1}{\boldmath{\textbf{##2}}} \hspace{0.2em} ##3 \hspace{0.3em} ##5\\[-0.4\baselineskip]
    %\end{list}
    \end{minipage}
    %\glstarget{##1}{\boldmath{\textbf{##2}}} \hspace{0.3em} ##3 \hspace{0.5em} ##5\par
    %\glstarget{##1}\boldmath{\textbf{##2}} \hspace{0.3em} ##3 \hspace{0.5em} ##5%\\[0.0\baselineskip plus 0.1\baselineskip minus 0.1\baselineskip]
}
}




%% Setup TOC
\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{3}
\renewcommand{\cfttoctitlefont}{\usekomafont{chapter}}
\renewcommand{\cftchapfont}{\rm\bf}
\renewcommand{\cftsecfont}{}
\newcommand{\nocontentsline}[3]{}
\newcommand{\tocless}[2]{\bgroup\let\addcontentsline=\nocontentsline#1{#2}\egroup}

%\newcommand{\appendixchapter}[1]{\tocless\chapter{#1}\addcontentsline{toc}{chapter}{\textbf{\chaptername~\thechapter\quad#1}}}
\newcommand{\appendixchapter}[1]{\chapter{#1}}

%% Setup HEADER/FOOTER
\clearscrheadfoot
\ihead{\headmark}
\ohead[\pagemark]{\pagemark}
\renewcommand{\chaptermark}[1]{\markboth{{\numberfont\color{textgray}\chaptername\,\thechapter}\enspace #1}{}}
\renewcommand{\sectionmark}[1]{\markright{{\numberfont\color{textgray}\thesection}\enspace #1}}
\renewcommand{\subsectionmark}[1]{\markright{{\numberfont\color{textgray}\thesubsection}\enspace #1}}
\fboxrule=\myrulewidth
%\ohead[\vspace{-0.6pt}\fcolorbox{gray}{gray!30}{\parbox[c][][c]{0.6cm}{\pagemark}}]{\vspace{-0.6pt}\fcolorbox{gray}{gray!30}{\parbox[c][][c]{0.6cm}{\pagemark}}}

%\renewcommand{\pagemark}{\markboth{\bf\color{gray}\thepage}{\bf\color{gray}\thepage}}

\setheadsepline{\myrulewidth}[\color{gray}]
%Vergroessere head&foot Breite
%\setheadwidth[0.5cm]{text}
%\setfootwidth[0.5cm]{text}
%Headschrift
\renewcommand*{\headfont}{\numberfont\small\slshape}
%\renewcommand*{\headfont}{\numberfont\small}
%\renewcommand{\headrulewidth}{0.5pt}
%alternativ: \renewcommand*{\headfont}{\normalfont\sffamily\scshape\large}
%Footschrift
%\renewcommand*{\footfont}{\numberfont}
%Seitenzahlschrift
\renewcommand*{\pnumfont}{\numberfont\small\upshape}


\renewcommand*\chapterpagestyle{empty} %removes header from all chapter pages
\addtocontents{toc}{\protect\thispagestyle{empty}} %hack to remove also header from 1st TOC page

\KOMAoptions{cleardoublepage=scrheadings} %adds header to cleared double pages


%% make env for pagestyle
\newenvironment{clearedpagestyle}{\clearpage\pagestyle{empty}\KOMAoptions{cleardoublepage=empty}}{\clearpage\pagestyle{scrheadings}\KOMAoptions{cleardoublepage=scrheadings}}



\mdfdefinestyle{chstyle}{%
    linewidth=1.5\myrulewidth,
    leftmargin=0pt,
    innerleftmargin=0.05\textwidth,
    rightmargin=0pt,
    innerrightmargin=0pt,
    innertopmargin=3pt,
    innerbottommargin=2pt,
    linecolor=gray,
    topline=false,
    rightline=false,
    bottomline=false,
    leftline=true
}

\def\headline#1{ {\color{gray}\hbox to \hsize{\lower.3em\hbox{#1}\hspace{2.5ex}\hrulefill}}}

\def\@makechapterhead#1{
     \parbox{\textwidth}{
        \chapterheadstartvskip
        %\parbox{\textwidth}{\headline{\textls*[180]{\Large\textsf{\chaptername}}\quad\LARGE\numberfont{\thechapter}}}\\[0.55cm]
        \parbox[c][][c]{0.08\textwidth}{\bf\color{gray}\fontsize{35}{35}\numberfont{\raisebox{-0.13em}{\thechapter}}}
        \hspace{0.04\textwidth}
        \parbox[c][][c]{0.86\textwidth}{\begin{mdframed}[style=chstyle]\textls*[120]{\color{textgray}\LARGE\textsf{{\chaptername}}}\\[0.3\baselineskip]\usekomafont{chapter} #1\end{mdframed}}\\[0.65cm]

        %\vspace{0.45cm}
        %\parbox{\textwidth}{\color{gray}\rule{\textwidth}{\myrulewidth}}\\[0.0cm]
    }
}

\setkomafont{chapter}{\normalfont\fontsize{21}{26}\selectfont\numberfont}
\renewcommand*{\chapterheadstartvskip}{\vspace{0.3cm}}
\renewcommand*{\chapterheadendvskip}{\vspace{0.8cm}}

\setkomafont{section}{\normalfont\huge\numberfont}
\setkomafont{subsection}{\normalfont\huge\numberfont}
\setkomafont{subsubsection}{\normalfont\huge\numberfont}

\RedeclareSectionCommands[
  beforeskip=0.01\baselineskip plus 0.3\baselineskip,
  afterskip=0.01\baselineskip
]{section,subsection,subsubsection}

\renewcommand{\@seccntformat}[1]{{\parbox[b][1\baselineskip][b]{\widthof{\csname the#1\endcsname.\hspace{1ex}}}{\csname the#1\endcsname.\hspace{1ex}}}} %dot after the(sub)section


%strecke zeilenabstände im table
\newcommand{\mytablestrech}{1.4}
\renewcommand{\arraystretch}{\mytablestrech}

%Schicke Bild- und Tabellenbeschreibungen

\usepackage[format=plain,indention=0.0cm]{caption} %use same as for parindent
\newlength{\letterheight}
\settoheight{\letterheight}{T}
\DeclareCaptionLabelSeparator{vline}{.\hspace{1.ex}{\color{gray}\rule{2\myrulewidth}{\letterheight}}\hspace{1.3ex}}
%\usepackage{subcaption}
\usepackage{subfig}
%\captionsetup{width=0.93\textwidth}

\setkomafont{captionlabel}{\bfseries\numberfont\small}
\renewcommand{\thefigure}{\arabic{chapter}.\arabic{figure}}
\renewcommand{\thesubfigure}{\alph{subfigure}}
\renewcommand{\thetable}{\arabic{chapter}.\arabic{table}}
%abstand zwischen caption und figure,table
\captionsetup[figure]{labelsep=vline,font={small,stretch=1.12},farskip=3pt,aboveskip=0.6\baselineskip,belowskip=0.0\baselineskip}
\captionsetup[table]{labelsep=vline,font={small,stretch=1.12},aboveskip=0\baselineskip,belowskip=0.5\baselineskip}
\captionsetup[subfloat]{labelsep=space,font={small,stretch=1.12},farskip=5pt,captionskip=3pt} %distance between fig & subcaption

\setlength\floatsep{1.2\baselineskip plus 3pt minus 1pt}
\setlength\textfloatsep{1\baselineskip plus 7pt minus 7pt}
\setlength\intextsep{1\baselineskip plus 7pt minus 7pt}

%placements
\newcommand{\mytable}[3][htb]{
    \begin{table}[#1]
    \centering
    \begin{minipage}[c]{0.93\textwidth}
    \caption{#2}
    \centering
    \small #3
    \end{minipage}
    \end{table}
}

\newcommand{\mytablesideways}[3][htb]{
    \begin{sidewaystable}[#1]
    \centering
    \caption{#2}
    \centering
    \small #3
    \end{sidewaystable}
}

\newcommand{\myfigure}[3][htb]{
    \begin{figure}[#1]
    \centering
    \begin{minipage}[c]{0.93\textwidth}
    \centering
    #3
    \caption{#2}
    \end{minipage}
    \end{figure}
}

\newcommand{\myfiguresideways}[3][htb]{
    \begin{sidewaysfigure}[#1]
    \centering
    #3
    \centering
    \caption{#2}
    \end{sidewaysfigure}
}


%references font
%\renewcommand\theremark{{\itshape\thesection\arabic{remark}}\reset@font}

% New definition of square root:
% it renames \sqrt as \oldsqrt
\let\oldsqrt\sqrt
% it defines the new \sqrt in terms of the old one
\def\sqrt{\mathpalette\DHLhksqrt}
\def\DHLhksqrt#1#2{%
\setbox0=\hbox{$#1\oldsqrt{#2\,}$}\dimen0=\ht0
\advance\dimen0-0.2\ht0
\setbox2=\hbox{\vrule height\ht0 depth -\dimen0}%
{\box0\lower0.38pt\box2}}

% define prime with better vertical alignment and no vertical space to fix line spreading
\let\oldprime\prime
\def\prime{\mathalpha{\raisebox{-0.5pt}[0pt][0pt]{$\scriptstyle\oldprime$}}}

%better hat
\let\oldhat\hat
\def\stacktype{L}
\stackMath
\def\dyhat{.067ex}
\renewcommand\hat[1]{\ThisStyle{%
              \stackon[\dyhat]{\SavedStyle#1}
                              {\SavedStyle\oldhat{\phantom{#1}}}}}


%replace tilde with widetilde
\let\oldtilde\tilde
\renewcommand{\tilde}[1]{\widetilde{#1}}

%replace bar with overline
\DeclareRobustCommand{\coverline}[1]{% clever overline
  \binrel@{#1}\binrel@@{\overline{#1}}%
}
\let\oldbar\bar
\renewcommand{\bar}[1]{\coverline{#1}}





%no linebreaks for inline equations
\binoppenalty=\maxdimen
\relpenalty=\maxdimen


%\def\prime{\mathpalette\myprime} 
%\def\myprime{\setbox0=-} %\raisebox{4.5pt}{$\scriptstyle\oldprime$}}

%% change equation numbering style
\def\tagform@#1{\maketag@@@{\ignorespaces{\small\numberfont(#1.)\enspace}\unskip\@@italiccorr}} %kill parenthesis
\renewcommand{\theequation}{\thechapter.\arabic{equation}}

%% paragraphs
\renewcommand\paragraph{\@startsection{paragraph}{4}{\z@}%
    {-0.1\parskip}%
    {-1em}%
    {\normalfont\normalsize\bfseries}
}

%%chapter intro
\newcommand{\intro}[1]{\parbox{\textwidth}{\textsl{#1}}\\[4\parskip]}


%% footnote
%\def\@fnsymbol#1{\ifcase#1\or $\bullet$\or $\bullet\bullet$\or $\bullet\bullet\bullet$\or$\bullet\bullet\bullet\bullet$\or $\bullet\bullet\bullet\bullet\bullet$\or \else\@ctrerr\fi} %define alternative numbering using *, **, ***, ...
\def\@fnsymbol#1{{\tiny(}\ifcase#1\or $\boldsymbol{\star}$\or $\boldsymbol{\star}\boldsymbol{\star}$\or $\boldsymbol{\star}\boldsymbol{\star}\boldsymbol{\star}$\or $\boldsymbol{\star}\boldsymbol{\star}\boldsymbol{\star}\boldsymbol{\star}$\or \else\@ctrerr\fi{\tiny)}}
%\renewcommand{\thefootnote}{\numberfont\arabic{footnote}} %style
\renewcommand{\thefootnote}{\numberfont\fnsymbol{footnote}} %style
%\counterwithin*{footnote}{page} %reset counter per new page
\setlength{\footnotesep}{\parskip}
\addtokomafont{footnote}{\small\setstretch{1.12}}
\renewcommand{\footnoterule}{%
  \vspace{-0.5\parskip}
  \vspace{\footskip}
  {\color{gray}\hrule width 0.35\textwidth height \myrulewidth}
  \kern 2pt
  
  %\vspace{-0.5\footnotesep}
}
%\renewcommand{\footnotelayout}{}

\deffootnote[2em] %mark width - allows 4 **** to be placed
      {2em} %indent of text
      {1em} %indent of paragraph
      {\textsuperscript{\thefootnotemark}\hspace{0.3em}} %def mark
      
%% Lists
\setlist[itemize,enumerate]{leftmargin=0.05\textwidth,itemsep=0.5\parskip,parsep=0pt,partopsep=0pt, topsep=0.0\parskip}
\setlist[description]{leftmargin=0.05\textwidth,font=\normalfont\rmfamily\bfseries\boldmath,itemsep=0.5\parskip,parsep=0pt,partopsep=0pt, topsep=0.0\parskip}
\renewcommand*{\descriptionlabel}[1]{\hspace{\labelsep}\descfont #1\hspace{0.3em}}

%Sonst================================================
\setlength{\jot}{2.0ex plus 0.5ex minus 0.2ex} %Vergroessert Zeilenabstand in align-Umgebung


%% Bib
\setlength{\labelsep}{1.25ex}


\newcommand{\setupTextStyle}{
    \setlength{\parindent}{0.cm} %Absatzeinzug
    \setlength{\parskip}{0.28\baselineskip plus 0.06\baselineskip minus 0.04\baselineskip}
    %\setlength{\parsep}{0cm}
    \renewcommand{\baselinestretch}{1.09}\normalsize


    %formel abstände 
    \setlength{\abovedisplayskip}{-0.4\baselineskip plus 0.1\baselineskip minus 0.2\baselineskip}
    \setlength{\abovedisplayshortskip}{-0.4\baselineskip plus 0.1\baselineskip minus 0.2\baselineskip}
    \setlength{\belowdisplayskip}{0.4\baselineskip plus 0.1\baselineskip minus 0.05\baselineskip}
    \setlength{\belowdisplayshortskip}{0.4\baselineskip plus 0.1\baselineskip minus 0.05\baselineskip}
}

